{"version":3,"file":"locale-switch.js","names":["LocaleSwitchModal","el","options","type","table","routeName","currentId","defaultId","inputId","langField","titleField","triggerInputName","Object","assign","buttons","querySelectorAll","u","each","button","addEventListener","e","saveCurrentAndCreateLang","switchLang","input","document","querySelector","form","validation","$validation","get","valid","validateAll","alert","__","Error","validateForm","post","task","code","dataset","lang","copy","targetId","directive","mounted","value","JSON","parse","module"],"sources":["locale-switch.js"],"sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nexport class LocaleSwitchModal {\n  options = {\n    type: '',\n    table: '',\n    routeName: '',\n    currentId: '',\n    defaultId: '',\n    inputId: '',\n    langField: '',\n    titleField: '',\n    triggerInputName: 'lang_assoc'\n  };\n\n  constructor(el, options) {\n    // the modal element\n    this.el = el;\n    this.options = Object.assign({}, this.options, options);\n\n    let buttons = this.el.querySelectorAll('[data-task=create_lang_version]');\n\n    u.each(buttons, (button) => {\n      button.addEventListener('click', (e) => {\n        this.saveCurrentAndCreateLang(button);\n      });\n    });\n\n    buttons = this.el.querySelectorAll('[data-task=switch_lang]');\n\n    u.each(buttons, (button) => {\n      button.addEventListener('click', (e) => {\n        this.switchLang(button);\n      });\n    });\n  }\n\n  validateForm() {\n    const input = document.querySelector('#' + this.options.inputId);\n\n    const form = input.form;\n\n    const validation = u.$validation.get(form);\n\n    const valid = validation.validateAll();\n\n    if (!valid) {\n      alert(u.__('luna.field.locale.switch.message.form.invalid'));\n      throw new Error('Form invalid');\n    }\n\n    return form;\n  }\n\n  /**\n   * @param {HTMLButtonElement} button\n   */\n  saveCurrentAndCreateLang(button) {\n    const form = this.validateForm();\n\n    u.form(form).post(\n      null,\n      {\n        [this.options.triggerInputName]: {\n          task: 'create',\n          type: this.options.type,\n          table: this.options.table,\n          routeName: this.options.routeName,\n          code: button.dataset.lang,\n          copy: button.dataset.copy,\n          langField: this.options.langField,\n          titleField: this.options.titleField,\n          currentId: this.options.currentId,\n          defaultId: this.options.defaultId\n        }\n      }\n    );\n  }\n\n  /**\n   * @param {HTMLButtonElement} button\n   */\n  switchLang(button) {\n    const form = this.validateForm();\n\n    u.form(form).post(\n      null,\n      {\n        [this.options.triggerInputName]: {\n          task: 'switch',\n          table: this.options.table,\n          routeName: this.options.routeName,\n          targetId: button.dataset.targetId\n        }\n      }\n    );\n  }\n}\n\nu.directive(\n  'locale-switch-modal',\n  {\n    mounted(el, { value }) {\n      const options = JSON.parse(value);\n\n      u.module(el, 'locale.switch', () => new LocaleSwitchModal(el, options));\n    }\n  }\n);\n\n"],"mappings":"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"}