{"version":3,"sources":["locale-switch.js"],"names":["System","register","_export","_context","LocaleSwitchModal","_defineProperty","obj","key","value","arg","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","String","Number","_toPrimitive","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","setters","_main","execute","el","options","this","type","table","constructor","routeName","currentId","inputId","langField","assign","titleField","querySelectorAll","u","triggerInputName","button","addEventListener","e","saveCurrentAndCreateLang","buttons","each","validateForm","form","$validation","get","validateAll","Error","document","validation","post","task","code","dataset","lang","defaultId","switchLang","targetId","mounted","_ref","module"],"mappings":"AAAAA,OAAOC,SAAS,CAAC,UAAU,SAAUC,EAASC,GAG5C,IAMWC,EAAiB,SAAAC,EAAAC,EAAAC,EAAAC,GAAA,OAAAD,EAAA,SAAAE,GAAA,IAAAF,EAAA,SAAAG,EAAAC,GAAA,GAAA,iBAAAD,GAAA,OAAAA,EAAA,OAAAA,EAAA,IAAAE,EAAAF,EAAAG,OAAAC,aAAA,QAAAC,IAAAH,EAAA,CAAA,IAAAI,EAAAJ,EAAAK,KAAAP,EAAAC,GAAA,WAAA,GAAA,iBAAAK,EAAA,OAAAA,EAAA,MAAA,IAAAE,UAAA,+CAAA,CAAA,OAAA,WAAAP,EAAAQ,OAAAC,QAAAV,EAAA,CAAAW,CAAAZ,EAAA,UAAA,MAAA,iBAAAF,EAAAA,EAAAY,OAAAZ,EAAA,CAAAe,CAAAf,MAAAD,EAAAiB,OAAAC,eAAAlB,EAAAC,EAAA,CAAAC,MAAAA,EAAAiB,YAAA,EAAAC,cAAA,EAAAC,UAAA,IAAArB,EAAAC,GAAAC,EAAAF,CAAA,CAP9B,OADAJ,EAAA,yBAAA,GACA,CACA0B,QAAA,CAAA,SAAAC,GAAA,GACAC,QAAA,WACA5B,EAAA,oBAAAE,EAAA,MALAF,YAAA6B,EAAAC,GAAA3B,EAAA4B,KAAA,UAAA,CAAAC,KAAA,GAAAC,MAAA,GAAAjC,UAAA,GAsBEkC,UAAc,GAAW/B,UAAAA,GAXvB6B,QAAQ,GACRC,UAAS,GACTE,WAAW,GACXC,iBAAa,eAUPL,KARNM,GAAOR,EASDE,KARNO,QAAajB,OAAAkB,OAAA,CAAA,EAAAR,KAAAD,QAAAA,GASP,IARNU,EAAYT,KAAEF,GAAAY,iBAAA,mCASRC,EARNC,KAAAA,GAAAA,IACDC,EAAAC,iBAAA,SAAAC,IAGCf,KAAAgB,yBAAAH,EAAA,GACI,IAGJI,EAAIA,KAAUnB,GAAIY,iBAAIA,2BAEtBC,EAAEO,KAAKD,GAAUJ,IACfA,EAAOC,iBAAiB,SAAUC,IAChCf,KAAKgB,WAAAA,EAAAA,GACL,GAMA,CACAG,eACE,MADFC,EADKN,SAAAA,cAA4B,IAAKd,KAAAD,QAAAO,SACvBc,KAGrB,IAFMT,EAAAU,YAAAC,IAAAF,GACFG,cAIF,MADFJ,MAAAA,EAAYA,GAAG,kDACP1C,IAAK+C,MAAGC,gBAId,OAAMC,CAAF,CAEAV,yBAGSH,GAFP,MAGJO,EAAUI,KAAML,eAClBR,EAAAS,KAAAA,GAAAO,KAAA,KAAA,CAEA,CAAA3B,KAAOoB,QAAIR,kBAAA,CACbgB,KAAA,SAHY3B,KAAMD,KAAKD,QAAQE,KAK/BC,MAAAF,KAAAD,QAAAG,MACFE,UAAAJ,KAAAD,QAAAK,UACAyB,KAAAhB,EAAAiB,QAAAC,KACEf,KAAAA,EAAAA,QAAyBH,KACvBN,UAAaP,KAAKmB,QAAAA,UAEhBC,WAAWO,KACX5B,QACAU,WACGJ,UAAYL,KAACY,QAAAA,UACZgB,UAAM5B,KAAQD,QAAAiC,YAJhB,CAEAC,WAOMpB,GANJ,MAOAN,EAASP,KAAEmB,eANXR,EAAES,KAOFX,GAAAA,KAAY,KAAKV,CANf,CAACC,KAOHK,QAAWO,kBAAaP,CACxB2B,KAAAA,SACF9B,MAAAF,KAAAD,QAAAG,MAEHE,UAAAJ,KAAAD,QAAAK,UACH8B,SAAArB,EAAAiB,QAAAI,WAGF,IANMvB,EAQJsB,UAAUA,sBAAS,CAPbE,QAQEf,EAAIgB,GAEVzB,IAAES,MAGE7C,GACEqD,EAVA,MAWA1B,EAAYH,KAAAA,MAAQG,GAVpBS,EAAE0B,OAWFjC,EAAS,iBAAeA,IAAAA,IAASjC,EAAA2B,EAAAC,IAVnC,GAEJ,EAEJ","file":"locale-switch.js","sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nexport class LocaleSwitchModal {\n  options = {\n    type: '',\n    table: '',\n    routeName: '',\n    currentId: '',\n    defaultId: '',\n    inputId: '',\n    langField: '',\n    titleField: '',\n    triggerInputName: 'lang_assoc'\n  };\n\n  constructor(el, options) {\n    // the modal element\n    this.el = el;\n    this.options = Object.assign({}, this.options, options);\n\n    let buttons = this.el.querySelectorAll('[data-task=create_lang_version]');\n\n    u.each(buttons, (button) => {\n      button.addEventListener('click', (e) => {\n        this.saveCurrentAndCreateLang(button);\n      });\n    });\n\n    buttons = this.el.querySelectorAll('[data-task=switch_lang]');\n\n    u.each(buttons, (button) => {\n      button.addEventListener('click', (e) => {\n        this.switchLang(button);\n      });\n    });\n  }\n\n  validateForm() {\n    const input = document.querySelector('#' + this.options.inputId);\n\n    const form = input.form;\n\n    const validation = u.$validation.get(form);\n\n    const valid = validation.validateAll();\n\n    if (!valid) {\n      alert(u.__('luna.field.locale.switch.message.form.invalid'));\n      throw new Error('Form invalid');\n    }\n\n    return form;\n  }\n\n  /**\n   * @param {HTMLButtonElement} button\n   */\n  saveCurrentAndCreateLang(button) {\n    const form = this.validateForm();\n\n    u.form(form).post(\n      null,\n      {\n        [this.options.triggerInputName]: {\n          task: 'create',\n          type: this.options.type,\n          table: this.options.table,\n          routeName: this.options.routeName,\n          code: button.dataset.lang,\n          copy: button.dataset.copy,\n          langField: this.options.langField,\n          titleField: this.options.titleField,\n          currentId: this.options.currentId,\n          defaultId: this.options.defaultId\n        }\n      }\n    );\n  }\n\n  /**\n   * @param {HTMLButtonElement} button\n   */\n  switchLang(button) {\n    const form = this.validateForm();\n\n    u.form(form).post(\n      null,\n      {\n        [this.options.triggerInputName]: {\n          task: 'switch',\n          table: this.options.table,\n          routeName: this.options.routeName,\n          targetId: button.dataset.targetId\n        }\n      }\n    );\n  }\n}\n\nu.directive(\n  'locale-switch-modal',\n  {\n    mounted(el, { value }) {\n      const options = JSON.parse(value);\n\n      u.module(el, 'locale.switch', () => new LocaleSwitchModal(el, options));\n    }\n  }\n);\n\n"]}