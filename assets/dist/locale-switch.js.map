{"version":3,"sources":["locale-switch.js"],"names":["System","register","_export","_context","LocaleSwitchModal","_defineProperty","obj","key","value","arg","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","String","Number","_toPrimitive","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","setters","_main","execute","constructor","el","options","this","type","table","routeName","currentId","defaultId","inputId","langField","titleField","triggerInputName","assign","buttons","u","each","button","e","addEventListener","querySelectorAll","validateForm","document","querySelector","form","get","$validation","alert","valid","__","Error","saveCurrentAndCreateLang","post","task","dataset","lang","code","copy","switchLang","targetId","directive","mounted","_ref","JSON","parse","module"],"mappings":"AAAAA,OAAOC,SAAS,CAAC,UAAU,SAAUC,EAASC,GAG5C,IAMWC,EAAiB,SAAAC,EAAAC,EAAAC,EAAAC,GAAA,OAAAD,EAAA,SAAAE,GAAA,IAAAF,EAAA,SAAAG,EAAAC,GAAA,GAAA,iBAAAD,GAAA,OAAAA,EAAA,OAAAA,EAAA,IAAAE,EAAAF,EAAAG,OAAAC,aAAA,QAAAC,IAAAH,EAAA,CAAA,IAAAI,EAAAJ,EAAAK,KAAAP,EAAAC,GAAA,WAAA,GAAA,iBAAAK,EAAA,OAAAA,EAAA,MAAA,IAAAE,UAAA,+CAAA,CAAA,OAAA,WAAAP,EAAAQ,OAAAC,QAAAV,EAAA,CAAAW,CAAAZ,EAAA,UAAA,MAAA,iBAAAF,EAAAA,EAAAY,OAAAZ,EAAA,CAAAe,CAAAf,MAAAD,EAAAiB,OAAAC,eAAAlB,EAAAC,EAAA,CAAAC,MAAAA,EAAAiB,YAAA,EAAAC,cAAA,EAAAC,UAAA,IAAArB,EAAAC,GAAAC,EAAAF,CAAA,CAAA,OAAAJ,EAAA,yBAAA,GAAA,CAAA0B,QAAA,CAAA,SAAAC,GAAA,GAAAC,QAAA,WAAA5B,EAAA,oBAAjBE,EAAN,MAaL2B,YAAYC,EAAIC,GAAS5B,EAAA6B,KAAA,UAZf,CACRC,KAAM,GACNC,MAAO,GACPC,UAAW,GACXC,UAAW,GACXC,UAAW,GACXC,QAAS,GACTC,UAAW,GACXC,WAAY,GACZC,iBAAkB,eAIlBT,KAAAF,GAAAA,EACAE,KAAKF,QAAOT,OAAAqB,OAAA,CAAA,EAAAV,KAAAD,QAAAA,GACZ,IAAIY,EAAQX,KAAGX,GAAOqB,iBAAgBX,mCAEtCa,EAAAC,KAAIF,GAAUG,IAEZD,EAAKF,iBAAqB,SAAAI,IAC1BD,KAAOE,yBAAwBF,EAAS,GACtC,IAEJH,EAAEX,KAAAF,GAAAmB,iBAAA,2BAEFN,EAAAA,KAAOA,GAAQb,IAEbe,EAAKF,iBAAqB,SAAAI,IAC1BD,KAAOE,WAAAA,EAAiB,GACtB,GADA,CAINE,eAEAA,MACQ1C,EADO2C,SAAAC,cAAA,IAAApB,KAAAD,QAAAO,SACCa,KAMd,IAJmBE,EAAAA,YAAIC,IAAAD,GAEFE,cAKnBC,MADFA,MAAKC,EAAKC,GAAE,kDACJd,IAAIe,MAAC,gBAEb,OAAAN,CAPI,CAEAO,yBAAyBd,GAU/B,MAAAO,EAAArB,KAAAkB,eACFN,EAAAS,KAAAA,GAAAQ,KAAA,KAAA,CACA,CAAA7B,KAAAD,QAAAU,kBAAA,CACEmB,KAAAA,SACE3B,KAAUD,KAAGD,QAAKmB,KAEhBG,MAASrB,KAAE6B,QAEX3B,MACGC,UAAYH,KAACS,QAAAA,UACZqB,KAAMhB,EAAAiB,QAAQC,KACd/B,KAAMa,EAAKf,QAAQE,KACnBC,UAAWF,KAACD,QAAQG,UACpBC,WAAWH,KAAKD,QAAQI,WACxB8B,UAAMnB,KAAOiB,QAAQC,UACrBE,UAAMpB,KAAOiB,QAAQG,YATvB,CAEAC,WAYArB,GACF,MACDO,EAAArB,KAAAkB,eACHN,EAAAS,KAAAA,GAAAQ,KAAA,KAAA,CAZU,CAAC7B,KAAKD,QAAQU,kBAAmB,CAc3CqB,KAAA,SACF5B,MAAAF,KAAAD,QAAAG,MACAC,UAAAH,KAAAD,QAAAI,UACEgC,SAAWrB,EAAQiB,QAAAK,WAVb,IAEFxB,EAAEyB,UAgBEnC,sBAAyB,CAf3BoC,QAgBEnC,EAAAA,GAfA,IAgBAiC,MACF9D,GAEHiE,EACH,MAAAxC,EAAAyC,KAAAC,MAAAnE,GACDsC,EAAA8B,OAAA5C,EAAA,iBAAA,IAAA,IAAA5B,EAAA4B,EAAAC,IAECsC,GAhBE,EAEJ","file":"locale-switch.js","sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nexport class LocaleSwitchModal {\n  options = {\n    type: '',\n    table: '',\n    routeName: '',\n    currentId: '',\n    defaultId: '',\n    inputId: '',\n    langField: '',\n    titleField: '',\n    triggerInputName: 'lang_assoc'\n  };\n\n  constructor(el, options) {\n    // the modal element\n    this.el = el;\n    this.options = Object.assign({}, this.options, options);\n\n    let buttons = this.el.querySelectorAll('[data-task=create_lang_version]');\n\n    u.each(buttons, (button) => {\n      button.addEventListener('click', (e) => {\n        this.saveCurrentAndCreateLang(button);\n      });\n    });\n\n    buttons = this.el.querySelectorAll('[data-task=switch_lang]');\n\n    u.each(buttons, (button) => {\n      button.addEventListener('click', (e) => {\n        this.switchLang(button);\n      });\n    });\n  }\n\n  validateForm() {\n    const input = document.querySelector('#' + this.options.inputId);\n\n    const form = input.form;\n\n    const validation = u.$validation.get(form);\n\n    const valid = validation.validateAll();\n\n    if (!valid) {\n      alert(u.__('luna.field.locale.switch.message.form.invalid'));\n      throw new Error('Form invalid');\n    }\n\n    return form;\n  }\n\n  /**\n   * @param {HTMLButtonElement} button\n   */\n  saveCurrentAndCreateLang(button) {\n    const form = this.validateForm();\n\n    u.form(form).post(\n      null,\n      {\n        [this.options.triggerInputName]: {\n          task: 'create',\n          type: this.options.type,\n          table: this.options.table,\n          routeName: this.options.routeName,\n          code: button.dataset.lang,\n          copy: button.dataset.copy,\n          langField: this.options.langField,\n          titleField: this.options.titleField,\n          currentId: this.options.currentId,\n          defaultId: this.options.defaultId\n        }\n      }\n    );\n  }\n\n  /**\n   * @param {HTMLButtonElement} button\n   */\n  switchLang(button) {\n    const form = this.validateForm();\n\n    u.form(form).post(\n      null,\n      {\n        [this.options.triggerInputName]: {\n          task: 'switch',\n          table: this.options.table,\n          routeName: this.options.routeName,\n          targetId: button.dataset.targetId\n        }\n      }\n    );\n  }\n}\n\nu.directive(\n  'locale-switch-modal',\n  {\n    mounted(el, { value }) {\n      const options = JSON.parse(value);\n\n      u.module(el, 'locale.switch', () => new LocaleSwitchModal(el, options));\n    }\n  }\n);\n\n"]}