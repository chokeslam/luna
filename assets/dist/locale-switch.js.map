{"version":3,"sources":["locale-switch.ts"],"names":[],"mappings":"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","file":"locale-switch.js","sourcesContent":["\r\nimport '@main';\r\n\r\ninterface LocaleSwitchOptions {\r\n  type: string;\r\n  table: string;\r\n  routeName: string;\r\n  currentId: string;\r\n  defaultId: string;\r\n  inputId: string;\r\n  langField: string;\r\n  titleField: string;\r\n  triggerInputName: string;\r\n}\r\n\r\nexport class LocaleSwitchModal {\r\n  public options: LocaleSwitchOptions = {\r\n    type: '',\r\n    table: '',\r\n    routeName: '',\r\n    currentId: '',\r\n    defaultId: '',\r\n    inputId: '',\r\n    langField: '',\r\n    titleField: '',\r\n    triggerInputName: 'lang_assoc'\r\n  };\r\n\r\n  constructor(public el: HTMLElement, options: Partial<LocaleSwitchOptions> = {}) {\r\n    // the modal element\r\n    this.options = Object.assign({}, this.options, options);\r\n\r\n    let buttons = this.el.querySelectorAll<HTMLButtonElement|HTMLAnchorElement>('[data-task=create_lang_version]');\r\n\r\n    u.each(buttons, (button) => {\r\n      button.addEventListener('click', (e) => {\r\n        this.saveCurrentAndCreateLang(button);\r\n      });\r\n    });\r\n\r\n    buttons = this.el.querySelectorAll<HTMLButtonElement|HTMLAnchorElement>('[data-task=switch_lang]');\r\n\r\n    u.each(buttons, (button) => {\r\n      button.addEventListener('click', (e) => {\r\n        this.switchLang(button);\r\n      });\r\n    });\r\n  }\r\n\r\n  validateForm() {\r\n    const input = document.querySelector<HTMLInputElement>('#' + this.options.inputId);\r\n\r\n    const form = input.form;\r\n\r\n    const validation = u.$validation.get(form);\r\n\r\n    const valid = validation.validateAll();\r\n\r\n    if (!valid) {\r\n      alert(u.__('luna.field.locale.switch.message.form.invalid'));\r\n      throw new Error('Form invalid');\r\n    }\r\n\r\n    return form;\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLButtonElement} button\r\n   */\r\n  saveCurrentAndCreateLang(button: HTMLButtonElement) {\r\n    const form = this.validateForm();\r\n\r\n    u.form(form).post(\r\n      null,\r\n      {\r\n        [this.options.triggerInputName]: {\r\n          task: 'create',\r\n          type: this.options.type,\r\n          table: this.options.table,\r\n          routeName: this.options.routeName,\r\n          code: button.dataset.lang,\r\n          copy: button.dataset.copy,\r\n          langField: this.options.langField,\r\n          titleField: this.options.titleField,\r\n          currentId: this.options.currentId,\r\n          defaultId: this.options.defaultId\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLButtonElement} button\r\n   */\r\n  switchLang(button: HTMLButtonElement) {\r\n    const form = this.validateForm();\r\n\r\n    u.form(form).post(\r\n      null,\r\n      {\r\n        [this.options.triggerInputName]: {\r\n          task: 'switch',\r\n          table: this.options.table,\r\n          routeName: this.options.routeName,\r\n          targetId: button.dataset.targetId\r\n        }\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\nu.directive(\r\n  'locale-switch-modal',\r\n  {\r\n    mounted(el, { value }) {\r\n      const options = JSON.parse(value);\r\n\r\n      u.module(el, 'locale.switch', () => new LocaleSwitchModal(el as HTMLElement, options));\r\n    }\r\n  }\r\n);\r\n\r\n"]}