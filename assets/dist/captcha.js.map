{"version":3,"file":"captcha.js","names":["GragwarCaptcha","el","options","$element","$image","querySelector","$input","$refreshButton","$buttonIcon","addEventListener","refresh","classList","add","src","dataset","image","t","Date","getTime","toString","Math","random","indexOf","remove","value","once","u","directive","mounted","module","RecaptchaCaptcha","type","key","callbackName","callback","jsVerify","form","closest","e","passCaptcha","preventDefault","stopPropagation","stopImmediatePropagation","grecaptcha","execute","window","response","requestSubmit","alert","__"],"sources":["captcha.js"],"sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nclass GragwarCaptcha {\n  constructor(el, options) {\n    this.$element = el;\n    this.options = options;\n    this.$image = this.$element.querySelector('[data-captcha-image]');\n    this.$input = this.$element.querySelector('[data-captcha-input]');\n    this.$refreshButton = this.$element.querySelector('[data-captcha-refresh]');\n    this.$buttonIcon = this.$element.querySelector('[data-refresh-icon]');\n\n    this.$refreshButton.addEventListener('click', () => {\n      this.refresh();\n    });\n  }\n\n  refresh() {\n    this.$buttonIcon.classList.add('fa-spin');\n\n    let src = this.$image.dataset.image;\n    const t = (new Date).getTime().toString() + '.' + (Math.random() * 10000);\n\n    if (src.indexOf('?') !== -1) {\n      src += '&t=' + t;\n    } else {\n      src += '?t=' + t;\n    }\n\n    this.$image.addEventListener('load', () => {\n      this.$buttonIcon.classList.remove('fa-spin');\n      this.$input.value= '';\n    }, { once: true });\n\n    this.$image.src = src;\n  }\n\n  clear() {\n    this.$input.value = '';\n  }\n}\n\nu.directive('captcha-gregwar', {\n  mounted(el) {\n    u.module(el, 'captcha.grwgwar', (el) => new GragwarCaptcha(el));\n  }\n});\n\nclass RecaptchaCaptcha {\n  constructor(el, type) {\n    u.import('https://www.google.com/recaptcha/api.js?339603074ca608664dacf816');\n\n    this.el = el;\n    this.type = type;\n\n    this.key = this.el.dataset.key;\n    this.callbackName = this.el.dataset.callback;\n\n    this.jsVerify = this.el.dataset.jsVerify;\n\n    if (this.jsVerify) {\n      const form = this.el.closest('form');\n\n      if (type === 'invisible') {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          grecaptcha.execute();\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n          form.requestSubmit();\n        }\n      } else {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          alert(u.__('luna.field.captcha.message.please.check.first'));\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n        }\n      }\n    }\n  }\n}\n\nu.directive('captcha-recaptcha', {\n  mounted(el, { value }) {\n    u.module(el, 'captcha.recaptcha', (el) => new RecaptchaCaptcha(el, value));\n  }\n});\n"],"mappings":"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"}