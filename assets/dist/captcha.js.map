{"version":3,"sources":["captcha.js"],"names":["System","register","_export","_context","GragwarCaptcha","RecaptchaCaptcha","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","setters","execute","el","options","_this","this","$image","$element","querySelector","$input","$refreshButton","$buttonIcon","addEventListener","value","_this2","classList","add","src","dataset","image","t","Date","getTime","toString","Math","random","indexOf","remove","once","u","directive","mounted","module","type","callbackName","callback","jsVerify","closest","form","e","passCaptcha","stopPropagation","stopImmediatePropagation","grecaptcha","window","preventDefault","response","alert","__","_ref"],"mappings":"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","file":"captcha.js","sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nclass GragwarCaptcha {\n  constructor(el, options) {\n    this.$element = el;\n    this.options = options;\n    this.$image = this.$element.querySelector('[data-captcha-image]');\n    this.$input = this.$element.querySelector('[data-captcha-input]');\n    this.$refreshButton = this.$element.querySelector('[data-captcha-refresh]');\n    this.$buttonIcon = this.$element.querySelector('[data-refresh-icon]');\n\n    this.$refreshButton.addEventListener('click', () => {\n      this.refresh();\n    });\n  }\n\n  refresh() {\n    this.$buttonIcon.classList.add('fa-spin');\n\n    let src = this.$image.dataset.image;\n    const t = (new Date).getTime().toString() + '.' + (Math.random() * 10000);\n\n    if (src.indexOf('?') !== -1) {\n      src += '&t=' + t;\n    } else {\n      src += '?t=' + t;\n    }\n\n    this.$image.addEventListener('load', () => {\n      this.$buttonIcon.classList.remove('fa-spin');\n      this.$input.value= '';\n    }, { once: true });\n\n    this.$image.src = src;\n  }\n\n  clear() {\n    this.$input.value = '';\n  }\n}\n\nu.directive('captcha-gregwar', {\n  mounted(el) {\n    u.module(el, 'captcha.grwgwar', (el) => new GragwarCaptcha(el));\n  }\n});\n\nclass RecaptchaCaptcha {\n  constructor(el, type) {\n    u.import('https://www.google.com/recaptcha/api.js?f57e89b2f336e4d0407348fb');\n\n    this.el = el;\n    this.type = type;\n\n    this.key = this.el.dataset.key;\n    this.callbackName = this.el.dataset.callback;\n\n    this.jsVerify = this.el.dataset.jsVerify;\n\n    if (this.jsVerify) {\n      const form = this.el.closest('form');\n\n      if (type === 'invisible') {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          grecaptcha.execute();\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n          form.requestSubmit();\n        }\n      } else {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          alert(u.__('luna.field.captcha.message.please.check.first'));\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n        }\n      }\n    }\n  }\n}\n\nu.directive('captcha-recaptcha', {\n  mounted(el, { value }) {\n    u.module(el, 'captcha.recaptcha', (el) => new RecaptchaCaptcha(el, value));\n  }\n});\n"]}