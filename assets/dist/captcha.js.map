{"version":3,"sources":["captcha.js"],"names":["GragwarCaptcha","el","options","$element","$image","querySelector","$input","$refreshButton","$buttonIcon","addEventListener","refresh","classList","add","src","dataset","image","t","Date","getTime","toString","Math","random","indexOf","remove","value","once","u","directive","mounted","module","RecaptchaCaptcha","type","key","callbackName","callback","jsVerify","form","closest","e","passCaptcha","preventDefault","stopPropagation","stopImmediatePropagation","grecaptcha","execute","window","response","requestSubmit","alert","__"],"mappings":"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","sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nclass GragwarCaptcha {\n  constructor(el, options) {\n    this.$element = el;\n    this.options = options;\n    this.$image = this.$element.querySelector('[data-captcha-image]');\n    this.$input = this.$element.querySelector('[data-captcha-input]');\n    this.$refreshButton = this.$element.querySelector('[data-captcha-refresh]');\n    this.$buttonIcon = this.$element.querySelector('[data-refresh-icon]');\n\n    this.$refreshButton.addEventListener('click', () => {\n      this.refresh();\n    });\n  }\n\n  refresh() {\n    this.$buttonIcon.classList.add('fa-spin');\n\n    let src = this.$image.dataset.image;\n    const t = (new Date).getTime().toString() + '.' + (Math.random() * 10000);\n\n    if (src.indexOf('?') !== -1) {\n      src += '&t=' + t;\n    } else {\n      src += '?t=' + t;\n    }\n\n    this.$image.addEventListener('load', () => {\n      this.$buttonIcon.classList.remove('fa-spin');\n      this.$input.value= '';\n    }, { once: true });\n\n    this.$image.src = src;\n  }\n\n  clear() {\n    this.$input.value = '';\n  }\n}\n\nu.directive('captcha-gregwar', {\n  mounted(el) {\n    u.module(el, 'captcha.grwgwar', (el) => new GragwarCaptcha(el));\n  }\n});\n\nclass RecaptchaCaptcha {\n  constructor(el, type) {\n    u.import('https://www.google.com/recaptcha/api.js?b1ca81dbcadaf81cb4f46623');\n\n    this.el = el;\n    this.type = type;\n\n    this.key = this.el.dataset.key;\n    this.callbackName = this.el.dataset.callback;\n\n    this.jsVerify = this.el.dataset.jsVerify;\n\n    if (this.jsVerify) {\n      const form = this.el.closest('form');\n\n      if (type === 'invisible') {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          grecaptcha.execute();\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n          form.requestSubmit();\n        }\n      } else {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          alert(u.__('luna.field.captcha.message.please.check.first'));\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n        }\n      }\n    }\n  }\n}\n\nu.directive('captcha-recaptcha', {\n  mounted(el, { value }) {\n    u.module(el, 'captcha.recaptcha', (el) => new RecaptchaCaptcha(el, value));\n  }\n});\n"],"file":"captcha.js"}